<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"/>
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<title>Lists for dojo 2</title>

	<link rel="stylesheet" type="text/css" href="../../../dui/mobile/list/List.css">
	<script type="text/javascript" src="../deviceTheme.js"></script>
	<script type="text/javascript" src="../../../dojo/dojo.js"
		data-dojo-config="packages: [{name: 'dojox', location:'../dui'}, {name: 'dijit', location:'../dui'}], async: true, parseOnLoad: true"></script>

	<script type="text/javascript">
		require([
			"dojo/_base/lang",
			"dojo/_base/array",
			"dojo/parser",
			"dui/registry",
			"dojo/on",
			"dui/mobile/list/List",
			"dojo/dom",
			"dojo/dom-construct",
			"dojo/dom-class",
			"dojo/request",
			"dojo/when",
			"dojo/store/util/QueryResults",
			"dojox/mobile/common"
		], function(lang, array, parser, registry, on, List, dom, domConstruct, domClass, request, when, QueryResults){
			
			/////////////////////////////////////////
			// Demo 2: 4999 entries
			/////////////////////////////////////////

			var list2Model = [];
			for (var i = 1; i < 5000; i++){
				list2Model.push({label: 'list entry ' + i});
			};
			var list2 = new List({height: 200, entries: list2Model}, 'list2');
			list2.startup();
			on(dom.byId('autoscroll'), 'click', function(){
				list2._animateScroll(dom.byId('fps').valueAsNumber, dom.byId('duration').valueAsNumber, dom.byId('length').valueAsNumber);
			});


			////////////////////////////////////////////////////
			// Demo 3: Shopping catalog using an HTML renderer
			////////////////////////////////////////////////////

			// the model that contains the list entries from the catalog
			var catalogModel = [];
			for (var i = 1; i < 100; i++){
				catalogModel.push({img: 'http://g-ecx.images-amazon.com/images/G/02/uk-dvd/images/warner/hbo-logo-small._SS50_V198464807_.jpg', title: 'The Sopranos episode ' + i, description: 'Tony is really really depressed, at least for the ' + i + 'st time...'});
			};
			// a controller that is also the renderer for the catalog entries
			var catalogController = {
				cart: {}, // the cart in which user push catalog entries to buy
				_selected: {}, // store information about catalog entries that are selected to display details
				render: function(entry, entryIndex){ // catalog entries renderer
					return '<div class="entryContainer"><div class="entryHeader"><img class="entryIcon" src="' + entry.img + '"/><span class="entryTitle">' + entry.title + '</span></div><div id="entryDetails' + entryIndex + '" class="entryDetails' + (this._selected[entryIndex]?'':' hidden') + '"><span class="entryDescription">' + entry.description + '</span><a class="' + (this.cart[entryIndex]?'hidden':'') + '" href="javascript:;">Add to Cart</a></div></div>';
				},
				onEntryClick: function(e, entryIndex){ // a handler for click events on a rendered catalog entry
					if(entryIndex != null){
						if(e.target.tagName == 'A'){
							// The "add to cart" link was clicked
							alert('Item ' + JSON.stringify(catalogModel[entryIndex]) + ' has been added to your cart.');
							domClass.toggle( e.target, 'hidden');
							this.cart[entryIndex] = true;
						}else{
							// toggle the hidden class on the entry Index
							domClass.toggle('entryDetails' + entryIndex, 'hidden');
							// notify the list that we have externaly updated its rendering, so that it
							// performs internal sizing calculations if it needs to.
							registry.byId('list3').renderingUpdated();
							// update our internal list of selected items
							if(this._selected[entryIndex]){
								delete this._selected[entryIndex];
							}else{
								this._selected[entryIndex] = true;
							}
						}
					}else{
						console.log(e);
					}
				}
			};
			// create a list widget for the catalog
			var list3 = new List({id: 'list3', height: 600, entries: catalogModel}, 'list3');
			// register our controller as the renderer for catalog entries
			list3.entriesRenderer = catalogController;
			// register our handler for click on a rendered catalog entry
			list3.onCellEvent('click', lang.hitch(catalogController, 'onEntryClick'));
			// startup the list
			list3.startup();

			////////////////////////////////////////////////////
			// Demo 4: Shopping catalog using a node renderer
			////////////////////////////////////////////////////

			var catalogRenderer = {
					cart: {},
					_handlers: {},
					_selected: {},
					render: function(entry, entryIndex){ // catalog entries renderer
						// create the domNote to return for the rendered entry
						var entryContainer = domConstruct.create('div', {className: 'entryContainer'});
						var entryHeader = domConstruct.create('div', {className: 'entryHeader'}, entryContainer);
						domConstruct.create('img', {src: entry.img}, entryHeader);
						domConstruct.create('span', {className: 'entryTitle', innerHTML: entry.title}, entryHeader);
						var entryDetails = domConstruct.create('div', {id: 'xEntryDetails' + entryIndex, className: 'entryDetails'}, entryContainer);
						if(!this._selected[entryIndex]){
							domClass.add(entryDetails, 'hidden');
						}
						domConstruct.create('span', {className: 'entryDescription', innerHTML: entry.description}, entryDetails);
						var cartLink = domConstruct.create('a', {innerHTML: 'Add to Cart', href: 'javascript:;'}, entryDetails);
						if(this.cart[entryIndex]){
							domClass.add(cartLink, 'hidden');
						}
						// Register handlers for clicks in the rendered list entry
						this._handlers[entryIndex] = [];
						// Callback for click in the entry header
						this._handlers[entryIndex].push(on(entryHeader, 'click', lang.hitch(this, function(e){
							// toggle the hidden class on the entry Index
							domClass.toggle('xEntryDetails' + entryIndex, 'hidden');
							// notify the list that we have externaly updated its rendering, so that it
							// performs internal sizing calculations if it needs to.
							registry.byId('list4').renderingUpdated();
							// update our internal list of selected items
							if(this._selected[entryIndex]){
								delete this._selected[entryIndex];
							}else{
								this._selected[entryIndex] = true;
							}
						})));
						// Callback for click on the "add to cart" link
						this._handlers[entryIndex].push(on(cartLink, 'click', lang.hitch(this, function(e){
							// The "add to cart" link was clicked
							alert('Item ' + JSON.stringify(catalogModel[entryIndex]) + ' has been added to your cart.');
							domClass.toggle( e.target, 'hidden');
							this.cart[entryIndex] = true;
						})));
						return entryContainer;
					},
					onCellCleanup: function(event){ // remove event handlers when a cleanup event is amited for the cell that display a list entry
						array.forEach(this._handlers[event.entryIndex], function(handler){
							handler.remove();
						});
					}
				};
			// create a list widget for the catalog
			var list4 = new List({id: 'list4', height: 600, entries: catalogModel}, 'list4');
			// register our custom renderer
			list4.entriesRenderer = catalogRenderer;
			// startup the list
			list4.startup();

			////////////////////////////////////////////////////
			// Demo 5: Different rendering for different catefories
			////////////////////////////////////////////////////

			// the model that contains the categorized list entries
			var fruitAndVegModel = [{type: 'fruit', name: 'Apple'},
			                        {type: 'fruit', name: 'Banana'},
			                        {type: 'fruit', name: 'Cranberry'},
			                        {type: 'fruit', name: 'Fig'},
			                        {type: 'fruit', name: 'Gooseberry'},
			                        {type: 'fruit', name: 'Grape'},
			                        {type: 'fruit', name: 'Kiwifruit'},
			                        {type: 'fruit', name: 'Lemon'},
			                        {type: 'fruit', name: 'Lime'},
			                        {type: 'fruit', name: 'Melon'},
			                        {type: 'fruit', name: 'Pear'},
			                        {type: 'fruit', name: 'Pineapple'},
			                        {type: 'fruit', name: 'Pomegranate'},
			                        {type: 'fruit', name: 'Pumpkin'},
			                        {type: 'fruit', name: 'Raspberry'},
			                        {type: 'fruit', name: 'Strawberry'},
			                        {type: 'fruit', name: 'Tomato'},
			                        {type: 'vegetable', name: 'Artichoke'},
			                        {type: 'vegetable', name: 'Broccoli'},
			                        {type: 'vegetable', name: 'Brussel sprout'},
			                        {type: 'vegetable', name: 'Caper'},
			                        {type: 'vegetable', name: 'Cauliflower'},
			                        {type: 'vegetable', name: 'Celery'},
			                        {type: 'vegetable', name: 'Kale'},
			                        {type: 'vegetable', name: 'Leek'},
			                        {type: 'vegetable', name: 'Lettuce'},
			                        {type: 'vegetable', name: 'Potatoes'},
			                        {type: 'vegetable', name: 'Spinach'},
			                        {type: 'vegetable', name: 'Watercress'},
			                        ];
			var fruitAndVegRenderer = {
				render: function(listEntry, listEntryIndex){
					return '<span class="' + listEntry.type + 'Entry">' + listEntry.name + '</span>';
				}	
			};
			// create a list widget for the categorized list
			var list5 = new List({id: 'list5', height: 200, entries: fruitAndVegModel, categoryAttribute: 'type'}, 'list5');
			// register our custom renderer
			list5.entriesRenderer = fruitAndVegRenderer;
			// startup the list
			list5.startup();

			////////////////////////////////////////////////////
			// Demo 6: Using a dojo object store with paging to retrieve list items
			////////////////////////////////////////////////////
			
			// our custom store
			var entriesStore = {
				query: function(query, options){
					var promise = request.get('../list/List.js').then(
						function(response){
							var i;
							var start = options ? (options.start ? options.start : 0) : 0;;
							var count = options && options.count;
							var entries = [];
							for(i=start; i < 500; i++){
								if (count && ((i - start) >= count)) {
									break;
								} else {
									entries[i - start] = {label: 'this is list entry ' + i}; 
								}
							}
							return entries;
						}
					);
					return new QueryResults(promise);
				}	
			};
 			var list6a = new List({id: 'list6a', height: 300, entries: {store: entriesStore, query: ''}, pageLength: 100}, 'list6a');
 			list6a.startup();
 			var list6b = new List({id: 'list6b', height: 300, entries: {store: entriesStore, query: ''}, pageLength: 100, cellPages: 0}, 'list6b');
 			list6b.startup();
 			
			////////////////////////////////////////////////////
			// Demo 7: pagingLength > 0 while not using a dojo object store (no paging)
			////////////////////////////////////////////////////

			var list7Model = [];
			for (var i = 1; i < 100; i++){
				list7Model.push({label: 'list entry ' + i});
			};
			var list7 = new List({height: 200, entries: list7Model, pageLength: 50}, 'list7');
			list7.startup();

			////////////////////////////////////////////////////
			// Demo 8: a categorized list that uses a dojo object store with paging to retrieve list items
			////////////////////////////////////////////////////
			
			var categorizedEntriesStore = {
					query: function(query, options){
						var promise = request.get('../list/List.js').then(
							function(response){
								var i;
								var category;
								var start = options ? (options.start ? options.start : 0) : 0;;
								var count = options && options.count;
								var entries = [];
								for(i=start; i < 2000; i++){
									if (count && ((i - start) >= count)) {
										break;
									} else {
										category = 'category ' + Math.floor(i / 10);
										entries[i - start] = {category: category, label: 'this is list entry ' + i}; 
									}
								}
								return entries;
							}
						);
						return new QueryResults(promise);
					}	
				};
			var list8 = new List({id: 'list8', height: 200, entries: {store: categorizedEntriesStore, query: ''}, categoryAttribute: 'category', pageLength: 50}, 'list8');
			list8.startup();

			////////////////////////////////////////////////////
			// Demo 9: list that supports single selection
			////////////////////////////////////////////////////

			var list9 = new List({height: 200, entries: list2Model, selectable: 'single'}, 'list9');
			list9.startup();
			var updateList9Console = function(){
				var selectedEntries = list9.getSelectedEntries();
				var i = 0;
				for(i; i < selectedEntries.length; i++){
					selectedEntries[i] = list2Model[selectedEntries[i]].label;
				}
				if(selectedEntries.length){
	 				dom.byId('list9Console').innerHTML = 'Selected entry: ' + selectedEntries;
				}else{
	 				dom.byId('list9Console').innerHTML = 'Selected entry: none';
				}
			};
 			list9.on('entryDeselected', updateList9Console);
 			list9.on('entrySelected', updateList9Console);
 
			////////////////////////////////////////////////////
			// Demo 10: list that supports multiple selection
			////////////////////////////////////////////////////

			var list10 = new List({height: 200, entries: list2Model, selectable: 'multiple'}, 'list10');
			list10.startup();
			var updateList10Console = function(){
				var selectedEntries = list10.getSelectedEntries();
				var i = 0;
				for(i; i < selectedEntries.length; i++){
					selectedEntries[i] = ' ' + list2Model[selectedEntries[i]].label;
				}
				if(selectedEntries.length){
	 				dom.byId('list10Console').innerHTML = 'Selected entries: ' + selectedEntries;
				}else{
	 				dom.byId('list10Console').innerHTML = 'Selected entries: none';
				}
			};
 			list10.on('entryDeselected', updateList10Console);
 			list10.on('entrySelected', updateList10Console);
 			
			////////////////////////////////////////////////////
			// Demo 11: categorized list that supports single selection
			////////////////////////////////////////////////////

			var list11 = new List({id: 'list11', height: 200, entries: {store: categorizedEntriesStore, query: ''}, categoryAttribute: 'category', selectable: 'single'}, 'list11');
			list11.startup();
			var updateList11Console = function(){
				var selectedEntries = list11.getSelectedEntries();
				if(selectedEntries.length){
	 				dom.byId('list11Console').innerHTML = 'Selected entry: ' + selectedEntries[0];
				}else{
	 				dom.byId('list11Console').innerHTML = 'Selected entry: none';
				}
			};
 			list11.on('entryDeselected', updateList11Console);
 			list11.on('entrySelected', updateList11Console);

 });
	</script>
	
	<style type="text/css">

		/* Styles for the demo page */

		.pbDescription{
			font-style: italic;
		}

		/* Catalog list entries */

 		.entryContainer{
			padding: 8px 8px 8px 8px;
		}

		.entryHeader{
			cursor: pointer;
		}

		.entryTitle{
			font-weight: bold;
			font-size: large;
			position: relative;
			padding-left: 10px;
			top: -18px;
		}

		.entryLabel{
			font-size: large;
			padding-left: 15px;
		}

		.entryDetails{
		}

		.entryDescription{
			font-style: italic;
		}

		.hidden{
			display: none;
		}

		/* Fruits and vegetables */
		
		.fruitEntry{
			color: red;
			font-size: xx-large;
		}
		
		.vegetableEntry{
			color: green;
			font-size: xx-large;
		}

	</style>
</head>
<body style="visibility:hidden;">

	<h2>Available list demos</h2>
	<p>
		The following demos are available on the page:
		<ul>
			<li><a href="#l1">Demo 1:</a> a list that is smaller than its viewport (<span class="pbDescription">work in progress, not currently working</span>)</li>
			<li><a href="#l2">Demo 2:</a> a list that displays 4999 entries in a small viewport</li>
			<li><a href="#l3">Demo 3:</a> a shopping catalog implemented using a list entries renderer that render HTML entries</li>
			<li><a href="#l4">Demo 4:</a> a shopping catalog implemented using a list entries renderer that render node entries</li>
			<li><a href="#l5">Demo 5:</a> a categorized list of fruits and vegetables</li>
			<li><a href="#l6">Demo 6:</a> two lists that uses a dojo object store with paging to retrieve list items</li>
			<li><a href="#l7">Demo 7:</a> a list with pagingLength > 0 while not using a dojo object store (no paging)</li>
			<li><a href="#l8">Demo 8:</a> a categorized list that uses a dojo object store with paging to retrieve list items</li>
			<li><a href="#l9">Demo 9:</a> a list that supports single selection</li>
			<li><a href="#l10">Demo 10:</a> a list that supports multiple selection</li>
			<li><a href="#l11">Demo 11:</a> a categorized list that supports single selection</li>
		</ul>
	<p>
	<!-- markup example -->
	<a id="l1"></a>
	<h2>Demo 1:</h2>
	<div id="list1" data-dojo-type="dui/mobile/list/List" data-dojo-props="height: 200, entries: [{label: 'entry001'},
	                                                                         {label: 'entry002'},
	                                                                         {label: 'entry003'},
	                                                                         {label: 'entry004'}]"></div>
	<!-- a really basic list with a lot of entries -->
	<a id="l2"></a>
	<h2>Demo 2: 4999 entries</h2>
	<div>fps: <input id='fps' type='number' value='25'/> duration (s): <input id='duration' type='number' value='3'/> length (px): <input id='length' type='number' value='-5000'/><button id='autoscroll'>auto scroll</button></div>
	<br>
	<div id="list2"></div>

	<!-- a sample shopping catalog using an HTML renderer for the catalog entries -->
	<a id="l3"></a>
	<h2>Demo 3: Shopping catalog using an HTML renderer</h2>
	<div id="list3"></div>
	
	<!-- a sample shopping catalog using a node renderer for the catalog entries -->
	<a id="l4"></a>
	<h2>Demo 4: Shopping catalog using a node renderer</h2>
	<p class="pbDescription">Current pb: on desktop, scrolling by dragging the list send a click event to the dragged entry...</p>
	<div id="list4"></div>

	<!-- a sample categorized list -->
	<a id="l5"></a>
	<h2>Demo 5: Categorized list</h2>
	<div id="list5"></div>

	<!-- a sample list that use a dojo object store with paging to retrieve list items -->
	<a id="l6"></a>
	<h2>Demo 6: Using a dojo object store with paging to retrieve list items</h2>
	<h3>List that use a fixed number of cells (cellPages == 2):</h3>
	<div id="list6a"></div>
	<h3>List that use one cell per list entry:</h3>
	<div id="list6b"></div>

	<!-- pagingLength > 0 while not using a dojo object store (no paging) -->
	<a id="l7"></a>
	<h2>Demo 7: pagingLength > 0 while not using a dojo object store (no paging)</h2>
	<div id="list7"></div>

	<!-- paging for a categorized list -->
	<a id="l8"></a>
	<h2>Demo 8: Paging for a categorized list</h2>
	<div id="list8"></div>

	<!-- list that supports single selection -->
	<a id="l9"></a>
	<h2>Demo 9: list that supports single selection</h2>
	<span id="list9Console">Selected entry: none</span>
	<div id="list9"></div>

	<!-- list that supports multiple selection -->
	<a id="l10"></a>
	<h2>Demo 10: list that supports multiple selection</h2>
	<span id="list10Console">Selected entries: none</span>
	<div id="list10"></div>

	<!-- categorized list that supports single selection -->
	<a id="l11"></a>
	<h2>Demo 11: categorized list that supports single selection</h2>
	<span id="list11Console">Selected entry: none</span>
	<div id="list11"></div>
	
	<p>
</body>
</html>
