<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>widget attribute unit test (in constructor and get()/set())</title>
	<script type="text/javascript" src="../boilerplate.js"></script>

	<script type="text/javascript">
		require([
			"doh/runner", "dui/register",
			"dojo/dom", "dojo/dom-attr", "dojo/dom-class", "dojo/dom-style", "dojo/sniff",
			"dui/Widget",
			"dojo/domReady!"
		], function (doh, register, dom, domAttr, domClass, domStyle, has, Widget) {

			doh.register("attributes", [
				// Test attributes mapped to DOMNodes
				function domMapping() {
					var IndividualMaps = register("individual-maps", [HTMLElement, Widget], {
						// Mapping foo to this.plainTextNode.foo
						foo: "",
						_setFooAttr: "plainTextNode",

						// Mapping bar to this.buttonNode.bar
						bar: "",
						_setBarAttr: "buttonNode",

						// Mapping plainText to this.plainTextNode.innerHTML
						plainText: "",
						_setPlainTextAttr: {node: "plainTextNode", type: "innerText"},

						buildRendering: function () {
							this.className = "class1";

							this.buttonNode = this.focusNode = this.ownerDocument.createElement("button");
							this.buttonNode.textContent = "hi";
							this.appendChild(this.buttonNode);

							this.plainTextNode = this.focusNode = this.ownerDocument.createElement("span");
							this.plainTextNode.textContent = "original plain text";
							this.appendChild(this.plainTextNode);
						}
					});

					var widget = new IndividualMaps({
						foo: "value1",
						bar: "value2",
						className: "class2",
						style: "height: 123px",
						plainText: "hello world <>&;",
						"name-with-dashes": "name with dashes"
					}).placeAt(dom.byId("wrapper"));

					// test attributes specified to constructor were copied over to DOM
					doh.is("value1", widget.plainTextNode.foo, "widget.plainTextNode.foo");
					doh.is("value2", widget.buttonNode.bar, "widget.buttonNode.bar");
					doh.t(domClass.contains(widget, "class2"), "class2");
					doh.is("hello world &lt;&gt;&amp;;", widget.plainTextNode.innerHTML, "innerHTML");
				},

				// tabIndex is problematic, see https://github.com/ibm-dojo/dui/issues/34.
				function specialNames() {
					// Test when tabIndex is declared top level, in the props passed to register().
					// TODO: enable when https://github.com/uhop/dcl/issues/9 is fixed
					/*
					var SpecialNames = register("test-special-names", [HTMLElement, Widget], {
						tabIndex: "0",

						postCreate: function () {
							this.watch("tabIndex", function(name, o, n){
								this.watchedTabIndex = n;
							})
						}
					});
					var widget = new SpecialNames({ });
					widget.tabIndex = "3";
					doh.is("3", widget.watchedTabIndex, "watch fired on widget");
					*/

					// And test when tabIndex is declared in a mixin.
					var SpecialNamesMixin = register.dcl(Widget, {
						tabIndex: "0",

						postCreate: function () {
							this.watch("tabIndex", function(name, o, n){
								this.watchedTabIndex = n;
							})
						}
					});
					var SpecialExtendedWidget = register("test-special-names-extended", [HTMLElement, SpecialNamesMixin], {
						tabIndex: "0",

						postCreate: function () {
							this.watch("tabIndex", function(name, o, n){
								this.watchedTabIndex = n;
							})
						}
					});

					var extended = new SpecialExtendedWidget({ });
					extended.tabIndex = "5";

					// test attributes specified to constructor were copied over to DOM
					doh.is("5", extended.watchedTabIndex, "watch fired on extended");

					// And also test for declarative widgets, to make sure the tabIndex property is
					// removed from the root node, to prevent an extra tab stop
					document.body.innerHTML += "<test-special-names-extended id=specialNames tabIndex=8/>";
					var declarative = document.getElementById("specialNames");
					register.upgrade(declarative);
					doh.f(declarative.hasAttribute("tabIndex"));
				}

			]);	// doh.register()

			doh.run();

		});	// require()

	</script>
</head>
<body>
<h1>Widget Attribute Unit Test</h1>

<div id="wrapper"></div>
</body>
</html>
