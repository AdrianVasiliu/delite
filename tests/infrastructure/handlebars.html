<!DOCTYPE>
<html>
<head>
	<title>dui/handlebars unit test</title>
	<script type="text/javascript" src="../boilerplate.js"></script>

	<script type="text/javascript">
		require(["doh/runner", "dojo/_base/declare", "dui/_WidgetBase", "dojo/domReady!"], function(doh, declare, _WidgetBase){
			doh.register("handlebars", [
				function load(){
					var d = new doh.Deferred();
					require(["dui/handlebars!dui/tests/infrastructure/templates/SimpleHandlebarsButton.html"], d.getTestCallback(function(br){
						// Test that function returned from dui/handlebars! creates the template correctly
						var TestButton = declare(_WidgetBase, {
							iconClass: "originalClass",
							label: "original label",
							buildRendering: br
						});
						myButton = new TestButton();
						doh.is("button", myButton.domNode.tagName.toLowerCase(), "root node exists");
						doh.is("span", myButton.domNode.firstChild.tagName.toLowerCase(), "icon node exists too");
						doh.is("duiReset originalClass", myButton.domNode.firstChild.className, "icon class set");
						doh.is("original label", myButton.domNode.textContent.trim(), "label set");
					}));
					return d;
				},
				function update(){
					// Test that updates to widget are reflected into template
					myButton.label = "new label";
					doh.is("new label", myButton.domNode.textContent.trim(), "label updated");

					myButton.iconClass = "newClass";
					doh.is("duiReset newClass", myButton.domNode.firstChild.className, "icon class set");
				},
				function branching(){
					var d = new doh.Deferred();
					require(["dui/handlebars!dui/tests/infrastructure/templates/HandlebarsButton.html"], d.getTestCallback(function(br){
						// Test false if condition
						var NoLabelButton = declare(_WidgetBase, {
							iconClass: "originalClass",
							showLabel: false,
							label: "original label",
							buildRendering: br
						});
						myButton = new NoLabelButton();
						doh.is("button", myButton.domNode.tagName.toLowerCase(), "root node exists");
						doh.is("span", myButton.domNode.firstChild.tagName.toLowerCase(), "icon node exists too");
						doh.is("duiReset originalClass", myButton.domNode.firstChild.className, "icon class set");
						doh.is("", myButton.domNode.textContent.trim(), "no label");
						myButton.label = "new label";
						doh.is("", myButton.domNode.textContent.trim(), "still no label");

						// Test true if condition
						var LabelButton = declare(_WidgetBase, {
							iconClass: "originalClass",
							showLabel: true,
							label: "original label",
							buildRendering: br
						});
						myButton = new LabelButton();
						doh.is("button", myButton.domNode.tagName.toLowerCase(), "root node exists");
						doh.is("span", myButton.domNode.firstChild.tagName.toLowerCase(), "icon node exists too");
						doh.is("duiReset originalClass", myButton.domNode.firstChild.className, "icon class set");
						doh.is("original label", myButton.domNode.textContent.trim(), "label");

						// Make sure that changes still work
						myButton.label = "new label";
						doh.is("new label", myButton.domNode.textContent.trim(), "label updated");
					}));
					return d;
				}
			]);	// doh.register()

			doh.run();
		});	// require()

	</script>
</head>
<body>
<h1>dui/handlebars Unit Test</h1>
<p>Check console for results.</p>
</body>
</html>
